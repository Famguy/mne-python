machine:
  environment:
    # We need to set this variable to let python see the package installed through apt-get
    PATH: "~/miniconda/envs/circleenv/bin:~/miniconda/bin:$PATH"
dependencies:
  cache_directories:
    - "~/miniconda"
    - "~/.mne"
  # Various dependencies
  pre:
    # Get a running Python
    - cd ~
    # rm -Rf ~/miniconda
    # wget -q http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh;
    # chmod +x miniconda.sh;
    # ./miniconda.sh -b;
    # conda create -n circleenv --yes pip python=2.7
    - ls -al ~/miniconda
    - ls -al ~/miniconda/bin
    - echo $PATH
    - conda update --yes --quiet conda
    - conda install --yes pip numpy scipy scikit-learn mayavi matplotlib sphinx PIL six IPython
    - which python
    - which pip
    - which ipython
    - pip install sphinx-gallery sphinx-bootstrap-theme PySurfer nilearn neo
  override:
    - python setup.py develop
    - python -c "import mne; print(mne.datasets.sample.data_path(verbose=True))"
    # Pipefail is requested to propagate exit code
    - set -o pipefail && cd doc && make html_dev 2>&1 | tee ~/log.txt
test:
  # Grep error on the documentation
  override:
    - cat ~/log.txt && if grep -q "Traceback (most recent call last):" ~/log.txt; then false; else true; fi
general:
  # Open the doc to the API
  artifacts:
    - "doc/_build/html"
    - "~/log.txt"
  # Restrict the build to the branch master only
  branches:
    only:
       - circle
