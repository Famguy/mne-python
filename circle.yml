machine:
  environment:
    # We need to set this variable to let python see the package installed through apt-get
    PYTHONPATH: "/usr/lib/python2.7/dist-packages"
dependencies:
  cache_directories:
    - "~/mne_data"
  # Various dependencies
  pre:
    - suda pt-get update
    - sudo apt-get install python-numpy python-scipy python-matplotlib python-PIL python-scikits-learn mayavi ipython
    - pip install sphinx sphinx-gallery sphinx-bootstrap-theme PySurfer nilearn neo
  override:
    - python setup.py develop
    - python -c "import mne; print(mne.datasets.sample.data_path(verbose=True))"
    # Pipefail is requested to propagate exit code
    - set -o pipefail && cd doc && make html_dev 2>&1 | tee ~/log.txt
test:
  # Grep error on the documentation
  override:
    - cat ~/log.txt && if grep -q "Traceback (most recent call last):" ~/log.txt; then false; else true; fi
general:
  # Open the doc to the API
  artifacts:
    - "doc/_build/html"
    - "~/log.txt"
  # Restrict the build to the branch master only
  branches:
    only:
       - circle
